[English](./RELEASE.md) | 简体中文

# ChatSpeed v1.1.1 发布日志

v1.1.1 是一个以提升稳定性和修复问题为核心的维护版本。我们深入优化了 `ccproxy` 代理模块的内部逻辑，特别是在协议兼容性和工具处理方面，以确保更可靠、更精确的 AI 交互。

## ✨ 功能增强 (Enhancements)

1.  **重构了工具调用的核心解析引擎 (Refactored Core Tool-Parsing Engine)**
    我们调整并引入了全新的工具调用解析机制。新引擎具有更强的兼容性和鲁棒性，能够更好地理解并处理来自 AI 的多样化输出，这不仅提升了解析成功率，也降低了 AI 使用工具的难度。

2.  **统一并增强了全协议的工具兼容模式 (Unified & Enhanced Tool Compatibility Mode)**
    工具兼容模式现已覆盖包括 Gemini 和 Claude 在内的所有协议。无论你使用何种后端模型，都能享受到通过增强引导带来的更流畅工作流和更高的目标完成率。

## 🐞 Bug 修复 (Bug Fixes)

- **修复了代理配置中“幽灵模型”的问题 (Fixed "Ghost Model" Issue in Proxy Configuration):** 解决了在编辑代理配置时，已删除的后端模型会残留在配置中且无法移除的问题。
- **修复了工具兼容模式下工具列表丢失的问题 (Fixed Missing Tool List in Compatibility Mode):** 解决了在特定场景下，启用工具兼容模式后，工具列表未能正确加载到提示词中的问题，确保了 AI 能够看到并使用所有可用工具。
- **修复了全局密钥轮换不均衡的问题 (Fixed Imbalanced Global Key Rotation):** 解决了因密钥轮换算法缺陷，导致部分密钥使用频率过高而超出速率限制（Rate Limit）的问题，确保了密钥使用的均衡性和服务的稳定性。

---

# ChatSpeed v1.1.0 发布日志

大家好！我们非常激动地发布 ChatSpeed v1.1.0 版本。本次我们从 v1.0.4 直接跳跃到 v1.1.0，因为它包含了一系列里程碑式的更新，特别是在**代理模块的工具兼容模式**和**搜索引擎支持**方面，这将极大地增强 AI 的能力和稳定性。

## 🚀 新增功能 (New Features)

1.  **强大的搜索引擎集成 (Powerful Search Engine Integration)**
    - 现在支持通过 API 密钥接入主流搜索引擎，包括 **Google Search API**, **Tavily API**, 和 **Serper API**。
    - 同时，我们内置了对 **Bing, DuckDuckGo, So.com, Sougou** 等搜索引擎的直接支持，为您提供多样化的信息源。

2.  **网页内容抓取与分析 (Web Content Scraping & Analysis)**
    - 新增了内置的网页抓取器（Scraper），可以从指定 URL 中提取文本或 Markdown 内容，让 AI 能够获取和分析实时网页信息。

3.  **灵活的提示词注入位置 (Flexible Prompt Injection)**
    - 为了适配不同模型（特别是对 `system` 角色支持较弱的模型），现在您可以选择将增强提示词注入到 `system` 角色或最后一条 `user` 消息中，极大地提升了兼容性。

## ✨ 功能增强 (Enhancements)

本次更新的核心，是围绕代理模块的“工具兼容模式”进行的一系列深度优化，旨在提供更稳定、更兼容、更流畅的智能体验。

### 1. 更稳定的工具调用

通过对工具兼容模式的底层进行重构，我们极大地提升了 AI 执行工具的稳定性和准确性。优化的工具定义（必填项前置、`(required)`/`(optional)` 标注）和更严谨的格式规则，为 AI 提供了一套清晰的“护栏”，能更好地驱动不同模型（即使是能力稍弱的模型）稳定、准确地执行任务。

### 2. 可定制的跨模型兼容性

我们引入了灵活的提示词注入机制。现在，您可以选择将增强提示词注入到 `system` 或 `user` 消息中。这一功能使得我们可以针对不同模型的特性进行优化，解决了部分模型对 `system` 角色响应不佳的问题，显著改善了各类模型在 `claude code` 等客户端中的表现。

### 3. 通过提示词引导优化工作流

我们通过大幅优化提示词，来辅助 AI 形成更健壮、更不容易中断的工作流。这包括：通过引导 AI 进行任务规划（优先使用 `TodoWrite` 等工具），以及实现智能容错（在工具调用解析失败时提供详细的“纠错指南”），从而显著提升复杂任务的执行成功率。

## 🐞 Bug 修复 (Bug Fixes)

- 修复了在处理流式响应时，因状态管理被意外破坏而导致的工具调用解析失败问题。
- 修复了当 XML 参数值无法被解析为指定类型（如 number）时，会错误地变成 `0` 或 `false` 的问题，现在会安全地回退到保留原始字符串，避免了数据篡改。
