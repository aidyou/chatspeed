[简体中文](./RELEASE.zh-CN.md) ｜ [English](./RELEASE.md)

# 发布日志

## [1.2.2]

### 🚀 新特性

- **新增代理切换窗口**：引入了一个轻量级的专用窗口，用于快速切换当前激活的代理分组。可通过系统托盘、标题栏菜单及快捷键快速唤起。
- **代理统计 UI 增强**：
  - **自动刷新持久化**：代理统计的自动刷新开关状态现在支持本地持久化存储。
  - **交互体验优化**：统计表格新增支持按客户端模型、后端模型及各类 Token 计数进行点击排序。

### 🪄 改进

- **公平权重轮询逻辑**：重构了代理轮询引擎，改为按供应商（Provider）进行分组调度。彻底解决了因单供应商配置多密钥或多别名导致的“权重爆炸”问题，确保流量分配严格遵循物理密钥比例。
- **鲁棒性统计记录**：引入了基于 RAII 机制的 `StreamStatGuard`，确保即使在流式响应异常中断或报错的情况下，代理使用统计也能被准确记录。
- **代理轮询器优化**：简化了内部架构，移除了冗余的读写锁，提升了并发性能与可维护性。
- **调试日志去噪**：更新了 VS Code 启动配置，禁用了 macOS 下冗余的 `OS_ACTIVITY_MODE` 日志输出。

### 🐞 修复

- **Windows 启动崩溃修复**：解决了在 Windows 平台上，若窗口事件（如调整大小或移动）在内部状态完全初始化前触发，可能导致程序 Panic 崩溃的关键问题。
- **统计记录遗漏修复**：修复了在流式响应意外结束时可能导致使用统计未正确入库的潜在问题。

---

## [1.2.1]

### 🐞 修复

- **隐私安全加固（附件脱敏）**：修复了敏感信息过滤逻辑在多模态（数组格式）消息下失效的严重漏洞。现在，通过附件（PDF/Word/图片分析等）提取的文本内容在发送给 AI 供应商之前，也会强制执行脱敏处理，确保隐私保护无死角。
- **Gemini 协议链路修复**：
  - **URL 生成逻辑校准**：修复了在提取 Base URL 时意外将 `https://` 中的冒号识别为后缀分隔符的漏洞，确保了后端请求 URL 的合法性。
  - **鉴权参数持久化**：修正了 Embedding 请求过程中 API Key 丢失的问题，确保转发至 Gemini 官方或兼容接口时身份验证始终有效。
- **后端供应商兼容性加固**：通过在代理层强制补全 `encoding_format: "float"` 并剔除空字符串参数，解决了部分严苛后端（如 Qwen/魔塔系列模型）报 400 错误的兼容性难题。

---

## [1.2.0]

### 🚀 新特性

- **全面支持 Embedding 代理协议**：
  - **多协议集成**：代理层现在原生支持 **OpenAI** (`/v1/embeddings`)、**Gemini** (`:embedContent`) 和 **Ollama** (`/api/embeddings`) 的嵌入协议。
  - **跨协议自动转换**：实现了完善的协议转换引擎。用户可以使用任一协议的客户端（如 OpenAI SDK）调用后端配置的其他协议模型，系统会自动处理请求结构、URL 拼接及响应包装。
  - **智能参数对齐**：针对部分后端供应商对可选参数（如 `encoding_format`）校验极其严格的问题，增加了自动清洗与补全逻辑。当从 Gemini/Ollama 转换为 OpenAI 协议时，会自动补全默认值（如 `float`），确保 100% 成功转发。
  - **专有拒绝路径**：为 Claude 协议开辟了独立的 `/v1/claude/embeddings` 路径。由于 Claude 官方暂不支持嵌入，该路径会返回明确的 501 错误提示，既保持了 API 结构的整齐对齐，又避免了与 OpenAI 标准路径冲突导致的程序异常。
- **MCP 代理路由架构重构**：
  - **路径统一化**：将 MCP 相关的 SSE 和 HTTP 路由统一整合至 `/mcp` 命名空间下，推出了 `/mcp/sse` 和 `/mcp/http` 标准端点。
  - **状态隔离优化**：通过 `nest_service` 实现了不同业务状态（SharedState 与 ChatState）的解耦，提升了并发请求下的系统稳定性。
  - **向下兼容**：保留了传统的 `/sse` 入口并标记为弃用，确保老版本客户端平滑过渡。

### 🪄 改进

- **API 文档与 UI 同步**：更新了代理设置页面中的 API 端点帮助表格，新增了 Embedding 相关的完整路径说明及占位符替换指南，显著提升了开发者体验（DX）。

### 🐞 修复

- **路由冲突加固**：彻底解决了因多个协议（OpenAI/Ollama/Claude）在某些模式下重复注册 `/v1/embeddings` 路径导致的程序启动 Panic。

---

## [1.1.26]

### 🚀 新特性

- **精细化代理统计**：新增“今天”统计维度，支持按自然日查看统计数据，与“最近 24 小时”维度互补，提供更符合直觉的数据观察视角。
- **自定义请求头防御系统**：
  - **全链路过滤机制**：在 `should_forward_header` 中内置受限头黑名单（如 `Host`、`Connection`、`Content-Length` 等），防止因自定义头冲突导致代理请求失败。
  - **源头校验增强**：在 AI 引擎设置界面（UI）增加实时校验，用户尝试保存非法头时将弹出多语言错误提示，避免配置后无法转发产生的疑虑。
  - **前缀感知防御**：拦截逻辑会自动识别并剥离 `cs-` 前缀后再进行安全比对，确保防御无死角。
- **模型 ID 鲁棒性增强**：
  - **全链路自动去噪**：在后端转发逻辑（请求体注入与 URL 拼接）以及前端模型设置（保存与导入）全面引入自动 `.trim()` 处理，彻底解决因配置中意外携带首尾空格导致的 API 鉴权或匹配失败。
  - **协议感知模型注入**：针对 OpenAI、Claude、Ollama 等协议，代理层现在会强制在请求体中插入正确的后端模型 ID，确保即使客户端未传 `model` 字段或传递了别名，后端也能收到预期的 ID。

### 🪄 改进

- **代理统计看板优化**：
  - **实时自动刷新**：看板现在支持每 10 秒自动更新一次数据，且自动刷新时不会触发全屏加载或清空当前视图，确保了观测的连续性与平滑性。
  - **并行请求优化**：统计看板的数据加载由串行改为并行（`Promise.all`），显著缩短了加载等待时间。
- **Header 转发架构重构 (Sandwich Logic)**：
  - **覆盖优先级梯队化**：重构了请求头构建流程，确立了 `客户端标准头 -> 供应商配置头 -> 协议必需头 -> 客户端 cs- 覆盖` 的层级结构。有效解决了供应商自定义头被客户端默认头意外覆盖的问题，同时赋予了客户端 `cs-` 前缀头最高级别的显式覆盖权。
  - **内部元数据透传**：恢复了 `X-Provider-Id`、`X-Model-Id` 和 `X-Internal-Request` 等内部标识头的透传功能，便于链路分析。
- **Token 估算算法校准**：修正了直连转发模式下的估算漏洞。现在仅针对消息中的**纯文本内容**进行 Token 计数，完全排除了 Base64 图片等二进制数据带来的海量计数异常，确保统计数据的准确性。
- **参数发送策略优化**：优化了 `stop`（停止符）等采样参数的处理。当配置为空或解析结果为空列表时，系统将不再发送该字段，以适配对空值校验较严格的后端供应商。
- **性能与鲁棒性增强**：
  - **流式处理加固**：恢复并优化了 Claude 协议下的末尾缓冲区刷新逻辑，确保在流异常中断等极端情况下也能完整产出结果。

### 🐞 修复

- **助手页面交互修复**：解决了助手窗口在失去焦点后无法自动隐藏，以及唤起后未能可靠聚焦输入框的问题。特别针对 macOS 优化了焦点处理逻辑，确保交互体验更加顺滑。
- **冗余代码清理**：移除了 `chat_handler.rs` 中多处重复的 Header 转发循环，优化了后端执行路径。
- **国际化同步**：补全了所有语言包中关于“自然日统计”和“受限头提示”的翻译。

---

## [1.1.25] - 2026-01-28

### 🚀 新特性

- **新增代理统计功能**：
  - **全量数据监控**：现在系统会自动记录所有通过代理模块的请求，包括请求的模型别名（客户端）、实际调用的模型 ID（后端）、供应商、协议及 HTTP 状态码。
  - **双模式统计入库**：无论是协议转换模式还是直连转发模式，均已实现自动统计，并支持记录详细的错误信息。
  - **精准 Token 追踪**：支持记录累计输入、输出及缓存 Token 数；当供应商未返回数据时，系统会自动启用基于字符计数的**智能估算逻辑**进行兜底。
- **全新可视化统计看板**：
  - **多维度图表分析**：新增后端模型使用分布（饼图）、错误代码分布（饼图）及每日 Token 消耗趋势（堆叠柱状图）。
  - **可视化看板**：在代理设置页面新增“统计信息”标签页，支持按天汇总及最近 24 小时/7天/30天/90天多跨度切换。
  - **深度下钻详情**：支持展开每日统计查看“统计详情”，清晰展示模型别名与后端模型的映射关系及各项指标。
  - **错误快速定位**：支持点击错误次数直接查看该日期下的错误码分布及具体错误原因。

### 🪄 改进

- **UI/UX 交互优化**：
  - **数据即时刷新**：新增一键刷新按钮，配合 `row-key` 优化，确保统计数据与图表能够即时同步渲染。
  - **列表滚动增强**：禁用了表格的越界回弹效果（Overscroll），滑动体验更干脆；固定了展开列至左侧，并优化了列宽和文本溢出处理。
  - **智能单位换算**：Token 数量支持自动换算为“万”或“亿”单位，并增加千分位分隔符，大额数据展示更直观。
- **系统架构稳健性**：
  - **数据库演进**：引入 V4 数据库迁移逻辑，新增 `ccproxy_stats` 表并配置了 `request_at`、`provider` 等关键字段索引，确保海量数据下的查询性能。
  - **错误防御增强**：后端 SQL 查询全面采用 `COALESCE` 保护，彻底杜绝了因脏数据或空值导致的类型解析错误。
  - **内存管理优化**：在前端组件卸载时自动销毁图表实例，防止内存泄漏。

---

## [1.1.24] - 2026-01-27

### 🚀 新特性

- **新增代理分组切换快捷窗**：
  - **高效唤起**：新增全局快捷键（默认 `Alt+Shift+P`）一键召唤轻量级代理切换面板
  - **流畅交互**：支持键盘 `↑`/`↓` 方向键预览、`Enter` 键即刻激活、`Esc` 键快速关闭
  - **智能显隐**：窗口失去焦点时自动隐藏，且在隐藏前自动解除置顶，确保不干扰主工作流
  - **完整交付**：内置了完善的窗口拖拽支持及全语种（繁中、日、韩、德、俄、葡、法、西）的配套翻译
  - **可靠注册**：优化了快捷键底层注册逻辑，确保应用启动后即可立即使用
- **代理服务器列表体验升级**：
  - **手风琴布局**：设置页面的代理列表重构为手风琴折叠样式，并配有平滑的过渡动画
  - **聚焦优化**：始终保持一个分组开启的逻辑，并同步补全了相关操作（如模板加载、工具模式切换）的多语言翻译
- **增强附件支持**：现在支持在聊天中发送图片以及多种办公文档：
  - **图片**：支持 JPG, PNG, GIF, WEBP, SVG, BMP 格式，支持直接粘贴或拖拽上传
  - **办公文档**：支持 PDF, DOCX, XLSX, XLS 格式的本地解析
- **本地化文件解析**：所有办公文档解析（PDF/Word/Excel）均在本地执行，不依赖任何外部网络或 CDN，确保在断网或受限网络下依然稳定可用
- **智能视觉模型集成**：
  - 发送图片或文档时，系统会自动调用配置的“视觉模型”生成内容描述或提取文本
  - 描述结果将作为上下文自动拼接到用户的提問中，显著提升 AI 对多模态内容的理解力
- **工具调用模式设置**：在代理分组中新增工具调用模式配置，支持三种模式：
  - **URL 设置**：根据请求路径自动判断（如 `/compat_mode/`），保持原有行为
  - **兼容模式**：强制使用 XML 格式的工具兼容模式，适配不支持原生工具调用的模型
  - **原生调用**：强制使用原生工具调用格式，提供最佳性能和兼容性
- **快捷切换工具模式**：在代理分组列表中新增工具模式切换图标，支持一键在三种模式间循环切换，实时显示当前模式状态
- **批量更新模板加载**：在批量更新对话框中新增"从模板加载"功能，可选择现有分组的配置快速填充到表单中，提高批量配置效率

### 🪄 改进

- **UI/UX 沉浸式优化**：
  - **即时响应**：点击发送后立即清空输入区并显示处理进度，提升交互流畅感
  - **进度可见性**：在聊天底部实时显示处理步骤（如“正在分析图片...”、“正在生成回复...”）
  - **自动滚动**：进度更新时窗口会自动滚动到底部，确保最新信息不被遮挡
  - **图片预览**：聊天气泡中的图片支持点击放大查看，移除冗余的附件名称显示
  - **错误回滚**：若视觉分析或消息存储失败，系统会自动将备份的文字和附件还原到输入区，确保数据不丢失
- **助手窗口交互优化**：
  - **布局重构**：将图标栏移至文本框下方并横向排列，解决界面拥挤和 Tooltips 遮挡问题
  - **智能置顶**：在选择附件时会自动临时开启窗口置顶，选择完成或关闭对话框后自动恢复原始状态，防止窗口意外隐藏
- **设置项优化**：为“视觉模型”和“标题生成模型”添加清除按钮，并修复了清空后显示为 `0` 的 UI Bug
- **上下文还原增强**：在多轮对话中，系统会自动从历史记录中还原视觉分析结果并使用 XML 标签包装，确保 AI 即使在切换模型后依然拥有完整的背景记忆
- **批量更新对话框优化**：增加对话框高度和滚动支持，确保表单内容不会被按钮遮挡
- **UI 对齐优化**：修复批量更新对话框中 label 和 checkbox 的垂直对齐问题

### 🐞 修复

- **同步请求修复**：修复了后端 OpenAI 协议对非流式（同步）请求的处理逻辑，解决了视觉分析等场景下的解析错误
- **消息重发修复**：修复了“重新发送”消息时可能导致发送空内容或丢失上下文的逻辑错误
- **代码健壮性**：修复了 `Index.vue` 中缺失 `SkillItem` 组件导入导致的引用错误
- **Tooltip 透明度修复**：优化了全局 CSS 变量，解决了 Tooltip 背景透明导致文字重叠的问题

---

## [1.1.23] - 2026-01-22

### 🚀 新特性

- **模型级自定义 Body 参数**：支持在具体的模型 ID 级别配置附加参数（如魔塔的 `enable_thinking`）。
- **动态分组切换 (`/switch`)**：新增统一的 `/switch` 路由前缀，代理会根据当前“激活”的分组动态转发请求，无需在 IDE 中频繁修改路径。
- **提示词关键词替换**：在代理分组中支持 KV 形式的文本替换规则，在请求发出前自动修正系统提示词（System Prompt）。
- **代理分组批量更新**：支持一键同步多个分组的提示词注入、文本替换及工具过滤设置。

### 🪄 改进

- **参数注入优先级金字塔**：确立了“模型补丁 > 用户 UI 设置 > 引擎默认值”的严密注入逻辑。
- **智能类型转换**：自定义参数支持自动将字符串 `"true"/"false"` 转换为布尔值，数字字符串转换为数值，确保供应商兼容性。
- **UI 重构**：代理分组编辑界面升级为选项卡（Tab）布局，风格与“AI 引擎”设置统一，解决了长列表遮挡按钮的问题。
- **增强鲁棒性**：`process_custom_params` 现在可以自动识别并处理多种嵌套级别的数据结构。

### 🐞 修复

- **魔塔/Qwen 兼容性补丁**：自动在非流式请求时强制关闭 `enable_thinking`，规避 400 报错。
- **UI 状态同步**：修复了内部聊天模块在转换过程中可能丢失 UI 实时参数（如温度、停止符）的问题。
- **Element Plus 适配**：修正了 `el-radio` 等组件的过时 API 用法警告。
- **安全增强**：移除了国际化消息中的 HTML 标签，解决 XSS 安全警告。

---

## [1.1.22] - 2026-01-21

本次更新带来了一个重磅功能：**智能敏感信息处理系统**。我们致力于在不牺牲 AI 交互体验的前提下，最大限度地保护您的隐私。现在系统能够自动识别并掩盖消息中的敏感信息，确保数据在发送给 AI 供应商之前已完成脱敏。

## ✨ 隐私与安全增强

- **全自动敏感信息过滤**: 在消息发送给 AI 之前，自动识别并掩盖邮箱、IP 地址、信用卡等通用隐私信息。
- **深度适配中英文场景**:
  - **中文深度优化**: 针对中国大陆地区的**身份证号、手机号、座机号、微信号/QQ号、银行卡/支付宝、中文姓名、地址、公司名、项目名、大写金额**等进行了专项适配。
  - **英文深度优化**: 支持识别 **SSN (社会安全码)、英文姓名、国际地址、公司名**等英文环境下的敏感信息。
- **灵活的名单管理**:
  - **自定义黑名单 (Blocklist)**: 允许用户添加特定词汇（如项目代号）强制过滤。
  - **白名单 (Allowlist)**: 允许用户添加例外词汇（如公开邮箱、本地 IP）豁免过滤。
- **极致安全策略**: 脱敏逻辑完全在本地 Rust 端执行，且数据库中仅存储脱敏后的安全数据。

## 🔧 交互与体验优化

- **新增快捷过滤开关**: 在主聊天窗口和助手窗口顶部新增 `filter` 按钮，支持一键切换脱敏状态，并实现跨窗口实时同步。
- **多语言 UI 支持**: 虽然深度脱敏目前主要针对中英文，但我们为脱敏后的**占位符 (Placeholders)** 提供了 10 种语言（中、英、日、韩、德、法、西、葡、俄）的本地化显示支持。

## 🐞 问题修复

- **内部清理**: 清理了冗余代码和未使用的函数，优化了程序运行效率。

---

# Chatspeed v1.1.21 发布日志

优化窗口显隐逻辑，修改后按下快捷键后只有在窗口获得焦点的时候才会隐藏否则会将窗口前置

## 🐞 问题修复

- 修复了在模型设置中切换 API 协议时，`baseUrl` 输入框无法编辑的问题。

# Chatspeed v1.1.19 发布日志

---

Chatspeed v1.1.19 是一个专注于**系统稳定性提升**和**数据安全性增强**的重要版本。本次更新通过全面优化错误处理机制，显著提升了问题排查效率；同时，引入了流式加解密技术，解决了大数据库文件备份时的内存消耗问题，确保即使处理海量数据也能保持系统稳定运行。此外，我们还修复了多个影响用户体验的关键问题，包括聊天界面解析错误、新模型兼容性以及跨平台窗口显示等问题，为您提供更加流畅、可靠的 AI 交互体验。

## 🔧 技术优化

- **错误序列化优化**: 统一优化了所有模块的错误序列化机制，现在错误信息中会包含具体的消息内容，便于问题排查
- **窗口管理增强**: 改进了窗口管理机制，增加了防抖快捷键支持和更好的错误处理
- **Web搜索工具增强**: 优化了 WebSearch 工具的实现，提升了搜索功能的稳定性和性能
- **数据备份优化**：优化了数据库备份逻辑，新增数据库备份加密

## 🐞 问题修复

- 优化聊天界面：修复了引用解析错误，并解决了因未正确解析部分供应商提供的 step 信息而导致聊天内容冗余的问题。
- 兼容 claude-sonnet-4-5 模型，支持其 `thinking.budget_tokens` 大于或等于 `max_tokens` 的情况。
- 优化设置窗口的最大高度，避免其超出屏幕显示范围。
- 移除了 Windows 平台爬虫 webview 的代理设置。现在所有平台的 webview 创建都统一依赖系统代理，解决了 Windows 11 上爬虫窗口可能无法使用的问题。
- 优化数据备份逻辑，移除对旧数据库的支持，新增对 mcp_sessions、schema、shared、static 等目录的备份支持

---

# Chatspeed v1.1.18 发布日志

Chatspeed v1.1.18 进一步提升了应用程序的启动性能和用户体验，特别是在 Windows 平台上。通过优化环境初始化过程，解决了启动时的卡顿和意外命令行窗口弹出的问题，并修正了发布记录中快捷键描述的准确性。

### 🔧 技术优化

- **优化环境初始化，解决启动卡顿和 panic 问题**: 将环境初始化过程重构为异步执行，解决了在 Windows 平台上启动时可能出现的卡顿和“运行时中启动运行时”的 panic 问题。
- **错误统一**: 统一了应用程序中所有错误的处理方式，确保错误信息的一致性和可读性。

### 🐞 Bug 修复

- **修复 Windows 启动时命令行弹窗**: 在 Windows 环境初始化时，对执行 shell 命令的子进程应用了 `CREATE_NO_WINDOW | DETACHED_PROCESS` 标志，彻底消除了启动时意外弹出的命令行窗口。
- **修正发布记录中快捷键描述**: 修正了发布记录中主窗口定位快捷键的描述，明确为仅支持左右平移。
- **ccproxy 修复**：修复了 ccproxy 模块在工具兼容模式下，流式输出时可能出现重复内容的问题。
- **对话修复**：修复了对话列表工具调用参数解析错误导致列表无法加载的问题。

### 🕰 进行中

已经完成部分 ReAct 逻辑，接下来继续开发该工作流模块

---

# Chatspeed v1.1.17 发布日志

Chatspeed v1.1.17 专注于提升跨平台稳定性和用户体验，通过解决 Windows 和 Linux 环境中的关键错误、优化环境变量加载以及修复关键设置组件中的 UI 状态管理问题。此版本还包含了未发布的 v1.1.16 中的所有功能和修复，包括新的窗口定位快捷键和统一的自定义事件格式。

### ✨ 功能增强

- **新增主窗口定位快捷键**: 新增主窗口居中、左移、右移快捷键，提升窗口管理效率
- **统一自定义事件格式**: 将所有自定义事件统一为 `cs://` 开头，规范应用内部事件系统

### 🔧 技术优化

- **全局快捷键优化**: 主窗口移动至左侧和右侧的快捷键升级为全局快捷键，无需应用处于活动状态即可触发

### 🐞 Bug 修复

- **修复 Windows ARM64 闪退问题**: 修复了 Windows ARM64 版本在 PD 虚拟机中安装后闪退的问题，通过显式指定 `sqlite3` 库路径解决。
- **修复 Windows 命令行弹窗问题**: 修复了 Windows 平台上启动 MCP 服务时意外弹出命令行窗口的问题。
- **修复 Windows MCP 启动错误**: 修复了 Windows 平台上 MCP 服务启动时，因直接运行 `npx` 脚本而非通过 `cmd /c` 包装导致的 `%1 is not a valid Win32 application` 错误。
- **优化日志可见性**: 优化了在 Linux 环境下查找 `npx` 等命令时，当 shell 找不到或内部命令失败时的日志输出级别，使其在生产环境中可见。
- **修复表单状态覆盖问题**: 修复了 `Agent.vue` 和 `Skill.vue` 组件中，编辑后添加新项时，表单数据未重置导致覆盖旧项的 bug。
- **修复初始语言设置问题**: 修复初次安装时语言设置错误指向简体中文的问题，现在将优先使用用户本机语言，若不支持则回退至英文
- **修复快捷键设置验证**: 修复快捷键设置为空时的错误提示
- **修复快捷键绑定机制**: 修复快捷键未设置导致模块快捷键绑定失败的问题
- **修复设置窗口切换**: 修复设置窗口打开后通过菜单切换其他设置窗口失效的问题
- **移除不可用供应商**: 删除内置的 `Pollinations` 供应商，因其经测试多数情况下无法使用
- **修复 Ubuntu 窗口显示**: 修复了 Ubuntu 下窗口最小化后无法通过快捷键显示的问题
- **修复 ubuntu 窗口显示**：修复了 ubuntu 下窗口最小化后无法通过快捷键显示的问题

### 🕰 进行中

已经完成部分 ReAct 逻辑，接下来继续开发该工作流模块

# Chatspeed v1.1.15 发布日志

v1.1.15 专注于提升工具调用的用户体验和系统稳定性，同时优化了 ccproxy 模块的协议转换能力。

### ✨ 功能增强

1. 优化了工具调用展示界面，同一轮会话中的多次工具调用现在会展示为单个会话
2. 优化了消息删除功能，删除消息时会一次性删除同一轮对话的所有工具调用信息
3. 优化了对话入口，现在所有对话错误都会通知给前端
4. 优化了错误信息，对于 HTTP 请求相关错误会返回状态码，便于前端根据情况进行适配
5. 优化了对话中的 Markdown 解析，采用流式解析机制，极大提高了解析效率和用户体验
6. 主窗口新增了 `ALT + ←/→` 快捷键，用于快速将窗口移动到左下角和右下角

### 🔧 技术优化

1. 优化了 ccproxy 模块的对话历史，在协议转换前预处理对话记录和工具调用记录，使其尽可能适合各种协议
2. 优化了 ccproxy 模块，现在可以通过定义注入模型条件，支持`*`和`?`通配符
3. 优化了数据库升级逻辑，利于后续版本更新管理

### 🐞 Bug 修复

1. 修复了一些模型（如 gtp-oss）在工具调用时因未按标准发送结束标志导致的工具调用中断问题，提高系统兼容性
2. 修复了 ccproxy 模块 gemini 协议转 claude 协议在复杂场景下工具结构不正确的问题

### 🕰 进行中

已经完成部分 ReAct 逻辑，接下来继续开发该工作流模块

# Chatspeed v1.1.14 发布日志

本次更新重点引入了**代理别名通配符支持**，极大地提升了模型配置的灵活性和便捷性。现在，您可以利用 `*` 和 `?` 等通配符来定义代理别名，无需频繁修改配置即可适应模型名称的变化。此外，我们还优化了搜索爬虫的过滤机制，修复了对话界面工具展开的 bug，并对模型配置流程进行了优化。

### ✨ 功能增强

- 优化了搜索爬虫，现在会自动过滤多媒体网站和多媒体文件，返回结果将按要求更精准。同时，`WebSearch` 工具的默认返回结果数量调整为 5 条，最大支持 30 条，以提供更灵活的搜索控制。
- 新增了代理别名通配符支持，现在支持通过`*`匹配多字符和`?`匹配单字符

### 🔧 技术优化

- 调整了 api 文档，以适配新的 MCP 代理
- 调整模型配置时，导入按钮从不可见变为禁用状态，以优化时间

### 🐞 Bug 修复

- 修复了对话界面有些工具无法展开的 bug

---

# Chatspeed v1.1.13 发布日志

本次更新专注于提升 MCP 代理的稳定性和功能扩展，同时优化了助手功能和内容提取能力。MCP 代理服务器方面，我们引入了 Streamable HTTP 协议解决了网络断连和电脑休眠导致的会话丢失问题。爬虫模块方面，我们修复了影响爬虫模块稳定性的关键问题，内容提取采用了 Readability 来提高内容区域识别准确性，减少垃圾信息带来的 token 不必要消耗。

### ✨ 功能增强

- **新增 openai 引用信息拓展字段**：为 OpenAI 兼容接口增加了引用信息的拓展字段，提供更丰富的引用数据。
- **优化助手快速发送信息功能**：优化了助手快速发送信息的体验（默认快捷键 `ALT+Z`），提升操作效率。
- **新增 Streamable HTTP 代理服务器协议**：新增 Streamable HTTP 代理服务器协议，入口端点为 `/mcp/http`，提供了更灵活的连接方式。
- **实现 Streamable HTTP 会话持久化与自动恢复**：通过引入先进的会话管理机制，实现了 Streamable HTTP 会话的磁盘持久化和自动恢复。这彻底解决了因网络断开、电脑休眠或代理服务器重启导致的 MCP 服务会话 ID 丢失（表现为 410 或 401 错误）问题，显著提升了连接的稳定性和用户体验。
- **优化爬虫模块内容提取**：优化了爬虫模块内容提取算法，当前版本在提取网页内容时可以精准识别内容区域，命中率提升至 90% ~ 95%。
- **重构 AI 对话机制**：重构了 AI 对话机制，现在的界面可以更好地展示工具调用过程；优化了系统提示词，使得 AI 可以更好地利用工具完成日常对话任务。
- **更新文档链接**：更新了 README 中的博客链接和英文文档链接，确保用户可以访问最新的文档资源。

### 🔧 技术优化

- **清理无效的 i18n**：清理了大量无效的国际化资源，减少应用体积并提升性能。
- **助手窗口大小调整**：调整了助手窗口大小，并实现自动根据用户调整大小进行还原，提升用户体验。
- **归档 Rust 实现的 ReAct 模块**：基于工作流模块调整，归档了原先 Rust 实现的 ReAct 模块，为新的工作流架构做准备。
- **采用 Readability 提高内容识别准确性**：爬虫模块我们采用了 Readability 算法来提高内容区域识别准确性，减少垃圾信息带来的 token 不必要消耗。

### 🐞 Bug 修复

- **修复 scraper 模块事件监听崩溃问题**：修复了 scraper 模块事件监听可能导致爬虫模块崩溃的问题，显著提升了爬虫功能的稳定性。
- **移除未使用的导入和依赖**：清理了项目中未使用的导入和依赖，优化了项目结构和构建效率。

---

# Chatspeed v1.1.12 发布日志

v1.1.12 版本专注于提升核心稳定性和优化关键用户体验。我们修复了可能导致程序崩溃的底层问题，并改进了助手和应用启动的工作流程，使其更加流畅和直观。

### ✨ 功能增强

- **优化助手快捷键工作流**: 现在，使用助手快捷键（默认为 `Alt+Z`）会直接发送粘贴板中的文本进行处理，无需再次按回车键确认，显著提升了操作效率。
- **改善应用首次启动体验**: 为了提供更友好的初始界面，应用在首次启动时会自动加载默认会话，而不是显示空白页。

### 🐞 Bug 修复

- **修复助手快捷键重复触发问题**: 解决了在某些情况下，助手快捷键会连续触发两次，导致同一条消息被重复发送给 AI 的问题。
- **修复采集器（Scraper）模块崩溃问题**: 修复了因 `scraper` 模块中的事件监听器处理不当而可能引发程序崩溃（panic）的严重问题，提升了网页内容抓取功能的稳定性。

### 🔧 技术优化

- **优化数据库初始化逻辑**: 移除了为初始会话硬编码的创建时间，改为在数据库首次创建时动态生成，使逻辑更加严谨。

---

# Chatspeed v1.1.11 发布日志

本次更新，我们专注于优化 AI 工具调用的稳定性和准确性，通过改进系统提示词和解析逻辑，让 AI 能够更可靠地使用工具来解答用户的问题。

### ✨ 功能增强

- 优化了聊天系统提示词，让 AI 可以更好地使用工具来解答用户的问题
- 优化了工具兼容模式的使用规范，提供更明确的使用示例让 AI 可以更好地理解并遵循工具 XML 使用规范
- 增强了 `WebFetch` 工具的稳定性，通过避免下载无法解析的文件（如 PDF, ZIP），提高了网页抓取功能的可靠性

### 🐞 Bug 修复

- 修复了工具兼容模式下工具调用解析会错误的将类似`Result<String, String>`代码解析为 HTML，导致工具调用失败的问题

---

# Chatspeed v1.1.10 发布日志

本次更新，我们致力于提升视觉体验与 AI 交互效率。通过新增 SVG 图表全屏显示功能，优化了视觉呈现；同时，我们精简了工具兼容模式的提示词，显著降低了 token 消耗，并引入了智能 token 估算，为您带来更流畅、更经济、更透明的 AI 使用体验。

### ✨ 效率与体验提升

1. 为 SVG 图表新增全屏显示支持，优化视觉体验
2. 优化工具兼容模式的提示词，删除与工具使用说明无关的信息，大大减小 token 消耗
3. 如果某些 AI 服务器返回的数据不包含输入输出 token，我们添加了估算值，主要用于提高用户感知

---

# Chatspeed v1.1.9 发布日志

v1.1.9 版本专注于修复关键 Bug、提升核心稳定性与统一跨平台体验。我们解决了在工具调用、MCP 代理、Windows 构建及 UI 兼容性方面的一系列问题，让您的 AI
交互体验更加流畅、可靠和美观。

🐞 Bug 修复

- 修复 MCP 代理重启后工具不可用的问题：解决了因 MCP 服务器重启导致客户端工具映射丢失的严重 Bug，确保了在重连后工具的可用性和会话的连续性。
- 修复多轮工具调用失败的问题：修复了在连续的多轮对话中，工具列表未能正确传递导致的工具调用失败问题。
- 修复采集器（Scraper）卡死问题：解决了内置网页采集器在使用一段时间后可能无法继续执行任务的问题，提升了长时间使用的稳定性。
- 修复工具调用UI点击事件Bug：修复了在聊天界面中，工具调用展示组件的点击事件失效问题。
- 修复 macOS 窗口边框问题：解决了在 macOS 平台上，应用窗口在某些情况下出现意外边框影响美观的问题。
- 修复工具调用参数问题：修复了代理模块工具兼容模式下整数类型解析存储后输出时可能被错误转为 number浮点型。
- **修复 Windows 初始化弹窗问题**：修复了在 Windows 平台上，MCP 模块在初始化过程中因执行外部命令而意外弹出命令行窗口的问题，优化了应用的静默启动体验。
- **解决了 Windows 本地开发环境的编译问题**：修复了在 Windows（特别是 ARM64）本地开发环境中，因 `vcpkg` 依赖链接问题导致的编译失败。此项修复统一了各平台的构建方式，并为后续 CI/CD 流程的适配和优化奠定了基础。

✨ 功能增强

- 统一跨平台视觉体验：重构了窗口的圆角和阴影效果，确保应用在 Windows, macOS 和 Linux 上拥有一致、美观的视觉表现。
- 优化 `ccproxy` 模块：进一步优化了 ccproxy 的工具兼容模式和调用说明，在保证可用性的前提下，显著减少了 Token 消耗，使工作流更顺畅、更经济。
- 依赖更新：升级了项目依赖，其中核心的 rmcp 库从 v0.5 升级到 v0.6，带来了更好的性能和稳定性。

---

# Chatspeed v1.1.8 发布日志

本次更新我们专注于**用户体验的全面优化**和**核心功能的增强**，为你带来更流畅、更智能、更个性化的使用感受。

### ✨ 界面与交互优化

- **布局统一**: 重新设计了主界面顶部及输入框下方的工具栏布局，使整体交互更加统一和便捷。
- **MCP 开关**: 在主界面新增了 MCP（模型上下文协议）功能的全局控制开关，方便快速启用或禁用。
- **发送键自定义**: 在设置中增加了发送消息快捷键的切换功能，你现在可以根据习惯选择使用 `Enter` 或 `Shift+Enter` 来发送消息。

### 🚀 效率提升

- **新建会话快捷键**: 新增了全局快捷键 `Cmd/Ctrl + N`，让你随时随地都能快速开启一段新对话。
- **切换侧边栏**: 新增 `Cmd/Ctrl + B` 快捷键，用于快速展开或折叠会话列表侧边栏。

### 🧠 AI 核心增强

- **全局系统提示词**: 引入了全新的系统提示词（System Prompt），让 AI 能更好地理解你的环境和意图，从而提供更精准、更智能的回复。
- **API 兼容性修复**: 解决了历史消息中工具调用（Tool Call）的格式兼容性问题，避免了因此导致的 API 请求失败。
- **Markdown 解析修复**: 修复了文本中引用格式与标准 Markdown 语法可能产生的冲突，确保了引用链接的正确渲染。

---

# Chatspeed v1.1.7 发布日志

v1.1.7 是一个紧急修复版本，解决了因简化模型配置导致无法添加模型的问题。

## 🔧 紧急修复

- **修复模型添加问题**：修复了因模型配置结构更改导致无法添加新模型的紧急问题。

---

# Chatspeed v1.1.6 发布日志

v1.1.6 是一个热修复版本，修复了前端显示问题并更新了依赖。

## 🔧 Bug 修复与优化

- **修复前端显示问题**：修复了 助手界面 中解析服务器端返回的 AI 数据时的工具标志 bug，该问题导致任意文本都会增加工具标志，造成前端显示意外换行
- **依赖更新**：更新 element-plus 依赖版本从 v2.8.5 到 v2.11.0

---

# Chatspeed v1.1.5 发布日志

v1.1.5 版本合并了之前所有的功能更新，并修复了导致此前版本编译失败的生命周期问题。

## ✨ 新功能与增强

- **单实例锁**：实现了单实例锁，防止应用同时运行多个实例。此项修复解决了在 macOS 上设置开机自启动后，重启系统时会启动两个应用的问题。
- **Windows 采集器代理**：Windows 平台的网页采集器现在会使用应用内为非认证 HTTP 代理设置的代理，提升了网络配置的一致性。

## 🔧 Bug 修复与优化

- **修复编译错误**：解决了在创建采集器窗口时因状态锁生命周期不明确导致的编译失败问题 (E0597)。
- **补全语言选项**：补充了翻译技能中缺失的语言选项。
- **采集器可靠性提升**：通过为动态加载内容的页面实现指数退避重试机制，提升了通用网页采集器的可靠性。

---

# Chatspeed v1.1.2 发布日志

v1.1.2 版本重点优化了工具调用功能和用户体验，通过重构核心模块提升了稳定性和兼容性。

## ✨ 新功能与重大改进

1. **全新工具调用架构**
    - 重构了聊天模块，通过 ccproxy 统一对接所有模型，使所有模型都具备工具调用能力
    - 简化了模型设置，移除了原有的"工具调用能力"开关，现在所有支持的模型都默认具备工具调用功能
    - 优化了工具调用的解析和展示，实时显示 AI 聊天过程中工具调用及其结果
    - 支持在历史聊天记录中完整展示工具调用记录

2. **改进的用户界面**
    - 新增联网控制开关，用户可以方便地控制是否启用网络搜索功能
    - 优化了聊天界面交互，工具调用部分现在以独立组件形式展示，支持展开/折叠查看参数和结果
    - 优化了模型添加流程，修复了可能无法显示"导入模型"按钮的问题

## 🔧 技术优化

- 重构了工具调用相关组件，提高了代码可维护性
- 优化了 ccproxy 认证机制，支持内部请求验证
- 改进了工具调用的解析逻辑，增强了对复杂参数的支持
- 更新了工具调用的展示样式，提供更好的视觉效果
- 优化了 ccproxy 模块的工具兼容模式，提升了对不同模型的适配性
- **优化了密钥轮换机制**: 重构了代理的密钥管理，采用原子化更新确保多密钥轮换的稳定性和可靠性，修复了潜在的竞态条件问题。

## 🐞 Bug 修复

- 修复了添加模型时可能无法显示"导入模型"按钮的问题
- 修复了工具调用结果显示不完整的问题
- 优化了网络请求处理，提升了稳定性
- 修复了部分界面显示问题，提升了用户体验

# Chatspeed v1.1.1 发布日志

v1.1.1 是一个以提升稳定性和修复问题为核心的维护版本。我们深入优化了 `ccproxy` 代理模块的内部逻辑，特别是在协议兼容性和工具处理方面，以确保更可靠、更精确的 AI 交互。

## ✨ 功能增强

1. **重构了工具调用的核心解析引擎**
    我们调整并引入了全新的工具调用解析机制。新引擎具有更强的兼容性和鲁棒性，能够更好地理解并处理来自 AI 的多样化输出，这不仅提升了解析成功率，也降低了 AI 使用工具的难度。

2. **统一并增强了全协议的工具兼容模式**
    工具兼容模式现已覆盖包括 Gemini 和 Claude 在内的所有协议。无论你使用何种后端模型，都能享受到通过增强引导带来的更流畅工作流和更高的目标完成率。

## 🐞 Bug 修复

- **修复了代理配置中“幽灵模型”的问题:** 解决了在编辑代理配置时，已删除的后端模型会残留在配置中且无法移除的问题。
- **修复了工具兼容模式下工具列表丢失的问题:** 解决了在特定场景下，启用工具兼容模式后，工具列表未能正确加载到提示词中的问题，确保了 AI 能够看到并使用所有可用工具。
- **修复了全局密钥轮换不均衡的问题:** 解决了因密钥轮换算法缺陷，导致部分密钥使用频率过高而超出速率限制（Rate Limit）的问题，确保了密钥使用的均衡性和服务的稳定性。

---

# Chatspeed v1.1.0 发布日志

大家好！我们非常激动地发布 Chatspeed v1.1.0 版本。本次我们从 v1.0.4 直接跳跃到 v1.1.0，因为它包含了一系列里程碑式的更新，特别是在**代理模块的工具兼容模式**和**搜索引擎支持**方面，这将极大地增强 AI 的能力和稳定性。

## 🚀 新增功能

1. **强大的搜索引擎集成**
    - 现在支持通过 API 密钥接入主流搜索引擎，包括 **Google Search API**, **Tavily API**, 和 **Serper API**。
    - 同时，我们内置了对 **Bing, DuckDuckGo, So.com, Sougou** 等搜索引擎的直接支持，为您提供多样化的信息源。

2. **网页内容抓取与分析**
    - 新增了内置的网页抓取器（Scraper），可以从指定 URL 中提取文本或 Markdown 内容，让 AI 能够获取和分析实时网页信息。

3. **灵活的提示词注入位置**
    - 为了适配不同模型（特别是对 `system` 角色支持较弱的模型），现在您可以选择将增强提示词注入到 `system` 角色或最后一条 `user` 消息中，极大地提升了兼容性。

## ✨ 功能增强

本次更新的核心，是围绕代理模块的“工具兼容模式”进行的一系列深度优化，旨在提供更稳定、更兼容、更流畅的智能体验。

### 1. 更稳定的工具调用

通过对工具兼容模式的底层进行重构，我们极大地提升了 AI 执行工具的稳定性和准确性。优化的工具定义（必填项前置、`(required)`/`(optional)` 标注）和更严谨的格式规则，为 AI 提供了一套清晰的“护栏”，能更好地驱动不同模型（即使是能力稍弱的模型）稳定、准确地执行任务。

### 2. 可定制的跨模型兼容性

我们引入了灵活的提示词注入机制。现在，您可以选择将增强提示词注入到 `system` 或 `user` 消息中。这一功能使得我们可以针对不同模型的特性进行优化，解决了部分模型对 `system` 角色响应不佳的问题，显著改善了各类模型在 `claude code` 等客户端中的表现。

### 3. 通过提示词引导优化工作流

我们通过大幅优化提示词，来辅助 AI 形成更健壮、更不容易中断的工作流。这包括：通过引导 AI 进行任务规划（优先使用 `TodoWrite` 等工具），以及实现智能容错（在工具调用解析失败时提供详细的“纠错指南”），从而显著提升复杂任务的执行成功率。

## 🐞 Bug 修复

- 修复了在处理流式响应时，因状态管理被意外破坏而导致的工具调用解析失败问题。
- 修复了当 XML 参数值无法被解析为指定类型（如 number）时，会错误地变成 `0` 或 `false` 的问题，现在会安全地回退到保留原始字符串，避免了数据篡改。
